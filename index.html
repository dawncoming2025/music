<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的音乐 | 曙光将至</title>
    <link rel="shortcut icon" href="https://cdn.luogu.com.cn/upload/image_hosting/cto5owfw.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #0f172a, #1e293b);
            color: #e2e8f0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }

        nav {
            background: rgba(15, 23, 42, 0.92);
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.25);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(74, 85, 104, 0.5);
        }

        nav .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        nav .logo {
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #63b3ed;
            text-shadow: 0 0 15px rgba(99, 179, 237, 0.5);
        }

        nav .nav-links {
            display: flex;
            gap: 1.8rem;
        }

        nav .nav-links a {
            color: #cbd5e0;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
            position: relative;
        }

        nav .nav-links a:hover {
            color: #fff;
            background: rgba(99, 179, 237, 0.15);
        }

        nav .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 2px;
            background: #63b3ed;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        nav .nav-links a:hover::after {
            width: 70%;
        }

        .RoundImg {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(99, 179, 237, 0.5);
            box-shadow: 0 0 15px rgba(99, 179, 237, 0.3);
        }

        main {
            padding: 3rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
            flex: 1;
            width: 100%;
        }

        h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
            background: linear-gradient(to right, #63b3ed, #90cdf4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 10px rgba(99, 179, 237, 0.2);
            text-align: center;
        }

        main p {
            color: #a0aec0;
            margin-bottom: 2.5rem;
            font-size: 1.2rem;
            max-width: 800px;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin: 2.5rem 0 1.5rem;
            color: #63b3ed;
            text-align: center;
            position: relative;
            padding-bottom: 10px;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: linear-gradient(to right, #63b3ed, #4299e1);
            border-radius: 2px;
        }

        .main-container {
            display: flex;
            flex-direction: column;
            gap: 40px;
            margin-top: 2rem;
        }

        .section-box {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(74, 85, 104, 0.3);
            transition: all 0.4s ease;
        }

        .section-box:hover {
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.4);
            border-color: rgba(99, 179, 237, 0.4);
        }

        .search-container {
            display: flex;
            margin-bottom: 25px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .search-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid rgba(99, 179, 237, 0.3);
            border-radius: 10px 0 0 10px;
            background: rgba(15, 23, 42, 0.6);
            color: #e2e8f0;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #63b3ed;
            box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.2);
        }

        .search-input::placeholder {
            color: #a0aec0;
        }

        .search-btn {
            padding: 12px 25px;
            background: linear-gradient(135deg, #4299e1, #63b3ed);
            color: white;
            border: none;
            border-radius: 0 10px 10px 0;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: linear-gradient(135deg, #3182ce, #4299e1);
        }

        .songs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .song-card, .playlist-card {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(74, 85, 104, 0.3);
            transition: all 0.4s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .song-card:hover, .playlist-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            border-color: rgba(99, 179, 237, 0.4);
        }

        .song-card::before, .playlist-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, #63b3ed, #4299e1);
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }

        .song-card:hover::before, .playlist-card:hover::before {
            transform: scaleX(1);
        }

        .song-title {
            font-weight: 600;
            font-size: 1.3rem;
            color: #e2e8f0;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .song-artist {
            font-size: 1.1rem;
            color: #90cdf4;
            margin-bottom: 5px;
        }

        .song-duration {
            font-size: 0.95rem;
            color: #a0aec0;
            margin-top: 8px;
        }

        .playlist-name {
            font-weight: 600;
            font-size: 1.3rem;
            color: #e2e8f0;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .playlist-count {
            font-size: 1rem;
            color: #90cdf4;
            background: rgba(99, 179, 237, 0.2);
            padding: 4px 10px;
            border-radius: 20px;
            display: inline-block;
        }

        .card-icon {
            font-size: 1.2rem;
            color: #63b3ed;
        }

        /* 分页样式 */
        .pagination-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 30px;
            gap: 10px;
        }

        .pagination-btn {
            padding: 8px 16px;
            background: rgba(30, 41, 59, 0.8);
            color: #cbd5e0;
            border: 1px solid rgba(74, 85, 104, 0.5);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .pagination-btn:hover:not(:disabled) {
            background: rgba(99, 179, 237, 0.2);
            color: #63b3ed;
            border-color: rgba(99, 179, 237, 0.5);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-pages {
            display: flex;
            gap: 8px;
        }

        .page-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(30, 41, 59, 0.8);
            color: #cbd5e0;
            border: 1px solid rgba(74, 85, 104, 0.5);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .page-btn:hover {
            background: rgba(99, 179, 237, 0.2);
            color: #63b3ed;
            border-color: rgba(99, 179, 237, 0.5);
        }

        .page-btn.active {
            background: rgba(99, 179, 237, 0.3);
            color: #63b3ed;
            border-color: rgba(99, 179, 237, 0.7);
            font-weight: bold;
        }

        .page-info {
            color: #a0aec0;
            font-size: 0.9rem;
            margin-top: 10px;
            text-align: center;
        }

        /* 加载状态 */
        .loading {
            text-align: center;
            padding: 30px;
            color: #90cdf4;
            grid-column: 1 / -1;
        }
        
        .loading-spinner {
            border: 4px solid rgba(99, 179, 237, 0.3);
            border-top: 4px solid #63b3ed;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            text-align: center;
            padding: 20px;
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid #ff5252;
            border-radius: 10px;
            margin: 20px 0;
            color: #ff5252;
            grid-column: 1 / -1;
        }
        
        .retry-btn {
            margin-top: 15px;
            padding: 8px 16px;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .retry-btn:hover {
            background: #3182ce;
        }

        .no-results {
            text-align: center;
            padding: 30px;
            color: #a0aec0;
            grid-column: 1 / -1;
            font-size: 1.1rem;
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .songs-grid {
                grid-template-columns: 1fr;
            }
            
            .section-title {
                font-size: 1.7rem;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .search-input {
                border-radius: 10px 10px 0 0;
                margin-bottom: 0;
            }
            
            .search-btn {
                border-radius: 0 0 10px 10px;
            }
            
            .pagination-container {
                flex-wrap: wrap;
            }
            
            .pagination-pages {
                order: 1;
                width: 100%;
                justify-content: center;
                margin-top: 10px;
            }
        }

        footer {
            background: rgba(15, 23, 42, 0.95);
            padding: 2.5rem 2rem;
            color: #a0aec0;
            border-top: 1px solid rgba(74, 85, 104, 0.4);
            margin-top: 4rem;
        }

        .footer-container {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            max-width: 1400px;
            margin: 0 auto;
            gap: 40px;
            flex-wrap: wrap;
        }

        .footer-left {
            display: flex;
            align-items: flex-start;
            gap: 40px;
        }

        .footer-logo {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            object-fit: cover;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .footer-logo:hover {
            transform: rotate(2deg) scale(1.05);
            box-shadow: 0 8px 20px rgba(99, 179, 237, 0.3);
        }

        /* 三列链接布局 */
        .footer-links-container {
            display: flex;
            gap: 40px;
        }

        .footer-links-column {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .footer-links-column h3 {
            color: #63b3ed;
            font-size: 1.2rem;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid rgba(99, 179, 237, 0.3);
        }

        .footer-links-column a {
            color: #cbd5e0;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            padding: 8px 15px;
            border-radius: 8px;
            background: rgba(30, 41, 59, 0.6);
            width: fit-content;
            min-width: 160px;
        }

        .footer-links-column a:hover {
            background: rgba(99, 179, 237, 0.2);
            color: #fff;
            transform: translateX(8px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .footer-links-column a::before {
            content: "»";
            color: #63b3ed;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .footer-links-column a:hover::before {
            opacity: 1;
        }

        .footer-right {
            text-align: right;
            min-width: 300px;
            padding-top: 10px;
        }

        .footer-right p {
            margin-bottom: 12px;
            font-size: 1.1rem;
        }

        .footer-right a {
            color: #63b3ed;
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }

        .footer-right a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background: #63b3ed;
            transition: width 0.3s ease;
        }

        .footer-right a:hover::after {
            width: 100%;
        }

        .footer-right a:hover {
            color: #90cdf4;
            text-shadow: 0 0 8px rgba(99, 179, 237, 0.4);
        }

        /* 响应式设计 */
        @media (max-width: 1100px) {
            .footer-container {
                flex-direction: column;
                gap: 30px;
            }
            
            .footer-left {
                flex-direction: column;
                gap: 20px;
            }
            
            .footer-right {
                text-align: left;
                min-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .footer-links-container {
                flex-direction: column;
                gap: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav>
        <div class="container">
            <div class="logo">
                <img class="RoundImg" src="https://cdn.luogu.com.cn/upload/image_hosting/cto5owfw.png"/>
                曙光将至
            </div>
            <div class="nav-links">
                <a href="https://dawncoming2025.github.io">主页</a>
                <a href="https://dawncoming2025.github.io/recommand">推荐</a>
                <a href="https://dawncoming2025.github.io/download">下载</a>
                <a href="https://dawncoming2025.github.io/blog">博客</a>
                <a href="https://dawncoming2025.github.io/team">团队</a>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <main>
        <h1>我的音乐</h1>
        
        <div class="main-container">
            <!-- 单曲查询部分 -->
            <div class="section-box">
                <h2 class="section-title">单曲查询</h2>
                
                <!-- 单曲搜索框 -->
                <div class="search-container">
                    <input type="text" id="songSearchInput" class="search-input" placeholder="搜索歌曲或歌手...">
                    <button id="songSearchBtn" class="search-btn">搜索</button>
                </div>
                
                <div class="songs-grid" id="songsContainer">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>正在加载歌曲列表...</p>
                    </div>
                </div>
                
                <!-- 单曲分页控件 -->
                <div class="pagination-container" id="songPagination" style="display: none;">
                    <button class="pagination-btn" id="songPrevBtn" disabled>
                        <i class="fas fa-chevron-left"></i> 上一页
                    </button>
                    <div class="pagination-pages" id="songPages"></div>
                    <button class="pagination-btn" id="songNextBtn">
                        下一页 <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="page-info" id="songPageInfo"></div>
            </div>
            
            <!-- 歌单查询部分 -->
            <div class="section-box">
                <h2 class="section-title">歌单查询</h2>
                
                <!-- 歌单搜索框 -->
                <div class="search-container">
                    <input type="text" id="playlistSearchInput" class="search-input" placeholder="搜索歌单...">
                    <button id="playlistSearchBtn" class="search-btn">搜索</button>
                </div>
                
                <div class="songs-grid" id="playlistsContainer">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>正在加载歌单列表...</p>
                    </div>
                </div>
                
                <!-- 歌单分页控件 -->
                <div class="pagination-container" id="playlistPagination" style="display: none;">
                    <button class="pagination-btn" id="playlistPrevBtn" disabled>
                        <i class="fas fa-chevron-left"></i> 上一页
                    </button>
                    <div class="pagination-pages" id="playlistPages"></div>
                    <button class="pagination-btn" id="playlistNextBtn">
                        下一页 <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="page-info" id="playlistPageInfo"></div>
            </div>
        </div>
    </main>

    <!-- 页尾 -->
    <footer>
        <div class="footer-container">
            <div class="footer-left">
                <img class="footer-logo" src="https://cdn.luogu.com.cn/upload/image_hosting/jxawvvuq.png" />
                <div class="footer-links-container">
                    <div class="footer-links-column">
                        <a href="https://dawncoming2025.github.io/help/">帮助中心</a>
                        <a href="https://dawncoming2025.github.io/help/faq">反馈问题</a>
                    </div>
                    <div class="footer-links-column">
                        <a href="https://dawncoming2025.github.io/team/join">加入团队</a>
                        <a href="https://dawncoming2025.github.io/help/update">更新日志</a>
                    </div>
                </div>
            </div>
            
            <div class="footer-right">
                <p>Developed by <a href="https://qm.qq.com/q/kD1XNMw2IK" target="_blank">DawnComing</a></p>
                <p>&copy; 2025~2035 曙光将至</p>
                <p>All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const songsContainer = document.getElementById('songsContainer');
            const playlistsContainer = document.getElementById('playlistsContainer');
            const songSearchInput = document.getElementById('songSearchInput');
            const songSearchBtn = document.getElementById('songSearchBtn');
            const playlistSearchInput = document.getElementById('playlistSearchInput');
            const playlistSearchBtn = document.getElementById('playlistSearchBtn');
            
            // 分页相关元素
            const songPagination = document.getElementById('songPagination');
            const songPrevBtn = document.getElementById('songPrevBtn');
            const songNextBtn = document.getElementById('songNextBtn');
            const songPages = document.getElementById('songPages');
            const songPageInfo = document.getElementById('songPageInfo');
            
            const playlistPagination = document.getElementById('playlistPagination');
            const playlistPrevBtn = document.getElementById('playlistPrevBtn');
            const playlistNextBtn = document.getElementById('playlistNextBtn');
            const playlistPages = document.getElementById('playlistPages');
            const playlistPageInfo = document.getElementById('playlistPageInfo');
            
            // 存储原始数据
            let allSongs = [];
            let allPlaylists = [];
            
            // 分页设置
            const SONGS_PER_PAGE = 9;
            const PLAYLISTS_PER_PAGE = 9;
            
            // 当前页码
            let currentSongPage = 1;
            let currentPlaylistPage = 1;
            
            // 从远程获取歌曲列表
            async function fetchSongList() {
                try {
                    const response = await fetch('https://dawncoming2025.github.io/music-upload/MusicList.bql');
                    if (!response.ok) {
                        throw new Error(`网络响应错误: ${response.status}`);
                    }
                    
                    const text = await response.text();
                    return parseSongList(text);
                } catch (error) {
                    console.error('获取歌曲列表失败:', error);
                    return null;
                }
            }
            
            // 解析歌曲列表文本
            function parseSongList(text) {
                const lines = text.trim().split('\n');
                const songList = [];
                
                for (const line of lines) {
                    // 分割每行数据：编号 歌曲名 歌手名 时长
                    const parts = line.split(' ');
                    
                    if (parts.length >= 4) {
                        const id = parts[0];
                        // 歌曲名可能包含空格，所以需要合并剩余部分
                        const title = parts.slice(1, parts.length - 2).join(' ');
                        const artist = parts[parts.length - 2];
                        const duration = parts[parts.length - 1];
                        
                        songList.push({
                            id,
                            title,
                            artist,
                            duration
                        });
                    }
                }
                
                return songList;
            }
            
            // 从远程获取歌单列表
            async function fetchPlaylistList() {
                try {
                    const response = await fetch('https://dawncoming2025.github.io/music-upload/PlayList.bql');
                    if (!response.ok) {
                        throw new Error(`网络响应错误: ${response.status}`);
                    }
                    
                    const text = await response.text();
                    return parsePlaylistList(text);
                } catch (error) {
                    console.error('获取歌单列表失败:', error);
                    return null;
                }
            }
            
            // 解析歌单列表文本
            function parsePlaylistList(text) {
                const lines = text.trim().split('\n');
                const playlistList = [];
                
                for (const line of lines) {
                    // 分割每行数据：歌单编号 歌单名称 歌曲数目
                    const parts = line.split(' ');
                    
                    if (parts.length >= 3) {
                        const id = parts[0];
                        // 歌单名称可能包含空格，所以需要合并剩余部分
                        const name = parts.slice(1, parts.length - 1).join(' ');
                        const count = parts[parts.length - 1];
                        
                        playlistList.push({
                            id,
                            name,
                            count
                        });
                    }
                }
                
                return playlistList;
            }
            
            // 渲染歌曲列表
            function renderSongs(songs, searchQuery = '', page = 1) {
                songsContainer.innerHTML = '';
                
                if (!songs || songs.length === 0) {
                    if (searchQuery) {
                        songsContainer.innerHTML = `
                            <div class="no-results">
                                <p>没有找到与"${searchQuery}"相关的歌曲</p>
                            </div>
                        `;
                    } else {
                        songsContainer.innerHTML = `
                            <div class="error-message">
                                <p>未能加载歌曲列表</p>
                                <button class="retry-btn" id="retrySongsBtn">重试</button>
                            </div>
                        `;
                        
                        document.getElementById('retrySongsBtn').addEventListener('click', initSongs);
                    }
                    songPagination.style.display = 'none';
                    return;
                }
                
                // 计算分页
                const totalSongs = songs.length;
                const totalPages = Math.ceil(totalSongs / SONGS_PER_PAGE);
                
                // 确保当前页在有效范围内
                currentSongPage = Math.max(1, Math.min(page, totalPages));
                
                // 计算当前页的起始索引
                const startIndex = (currentSongPage - 1) * SONGS_PER_PAGE;
                const endIndex = Math.min(startIndex + SONGS_PER_PAGE, totalSongs);
                const currentSongs = songs.slice(startIndex, endIndex);
                
                // 渲染当前页的歌曲
                currentSongs.forEach(song => {
                    const songCard = document.createElement('div');
                    songCard.className = 'song-card';
                    
                    songCard.innerHTML = `
                        <div class="song-title">
                            <i class="fas fa-music card-icon"></i>
                            ${song.title}
                        </div>
                        <div class="song-artist">${song.artist}</div>
                        <div class="song-duration">${song.duration}</div>
                    `;
                    
                    songCard.addEventListener('click', () => {
                        // 跳转到单曲播放页面
                        window.open(`https://dawncoming2025.github.io/music/single#${song.id}`, '_blank');
                    });
                    
                    songsContainer.appendChild(songCard);
                });
                
                // 更新分页控件
                updatePagination('song', currentSongPage, totalPages, totalSongs);
            }
            
            // 渲染歌单列表
            function renderPlaylists(playlists, searchQuery = '', page = 1) {
                playlistsContainer.innerHTML = '';
                
                if (!playlists || playlists.length === 0) {
                    if (searchQuery) {
                        playlistsContainer.innerHTML = `
                            <div class="no-results">
                                <p>没有找到与"${searchQuery}"相关的歌单</p>
                            </div>
                        `;
                    } else {
                        playlistsContainer.innerHTML = `
                            <div class="error-message">
                                <p>未能加载歌单列表</p>
                                <button class="retry-btn" id="retryPlaylistsBtn">重试</button>
                            </div>
                        `;
                        
                        document.getElementById('retryPlaylistsBtn').addEventListener('click', initPlaylists);
                    }
                    playlistPagination.style.display = 'none';
                    return;
                }
                
                // 计算分页
                const totalPlaylists = playlists.length;
                const totalPages = Math.ceil(totalPlaylists / PLAYLISTS_PER_PAGE);
                
                // 确保当前页在有效范围内
                currentPlaylistPage = Math.max(1, Math.min(page, totalPages));
                
                // 计算当前页的起始索引
                const startIndex = (currentPlaylistPage - 1) * PLAYLISTS_PER_PAGE;
                const endIndex = Math.min(startIndex + PLAYLISTS_PER_PAGE, totalPlaylists);
                const currentPlaylists = playlists.slice(startIndex, endIndex);
                
                // 渲染当前页的歌单
                currentPlaylists.forEach(playlist => {
                    const playlistCard = document.createElement('div');
                    playlistCard.className = 'playlist-card';
                    
                    playlistCard.innerHTML = `
                        <div class="playlist-name">
                            <i class="fas fa-list card-icon"></i>
                            ${playlist.name}
                        </div>
                        <div class="playlist-count">${playlist.count} 首歌曲</div>
                    `;
                    
                    playlistCard.addEventListener('click', () => {
                        // 跳转到歌单页面
                        window.open(`https://dawncoming2025.github.io/music/${playlist.id}`, '_blank');
                    });
                    
                    playlistsContainer.appendChild(playlistCard);
                });
                
                // 更新分页控件
                updatePagination('playlist', currentPlaylistPage, totalPages, totalPlaylists);
            }
            
            // 更新分页控件
            function updatePagination(type, currentPage, totalPages, totalItems) {
                const itemsPerPage = type === 'song' ? SONGS_PER_PAGE : PLAYLISTS_PER_PAGE;
                const paginationEl = type === 'song' ? songPagination : playlistPagination;
                const prevBtn = type === 'song' ? songPrevBtn : playlistPrevBtn;
                const nextBtn = type === 'song' ? songNextBtn : playlistNextBtn;
                const pagesEl = type === 'song' ? songPages : playlistPages;
                const pageInfoEl = type === 'song' ? songPageInfo : playlistPageInfo;
                
                // 显示分页控件
                paginationEl.style.display = 'flex';
                
                // 更新上一页/下一页按钮状态
                prevBtn.disabled = currentPage <= 1;
                nextBtn.disabled = currentPage >= totalPages;
                
                // 清除现有页码按钮
                pagesEl.innerHTML = '';
                
                // 生成页码按钮
                const startPage = Math.max(1, currentPage - 2);
                const endPage = Math.min(totalPages, currentPage + 2);
                
                for (let i = startPage; i <= endPage; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.addEventListener('click', () => {
                        if (type === 'song') {
                            currentSongPage = i;
                            renderSongs(getCurrentSongs(), songSearchInput.value, currentSongPage);
                        } else {
                            currentPlaylistPage = i;
                            renderPlaylists(getCurrentPlaylists(), playlistSearchInput.value, currentPlaylistPage);
                        }
                        updateURLParams();
                    });
                    pagesEl.appendChild(pageBtn);
                }
                
                // 更新页面信息
                const startItem = (currentPage - 1) * itemsPerPage + 1;
                const endItem = Math.min(currentPage * itemsPerPage, totalItems);
                pageInfoEl.textContent = `显示第 ${startItem} - ${endItem} 条，共 ${totalItems} 条`;
            }
            
            // 搜索歌曲
            function searchSongs(query) {
                currentSongPage = 1;
                const filteredSongs = getFilteredSongs(query);
                renderSongs(filteredSongs, query, currentSongPage);
                updateURLParams();
            }
            
            // 搜索歌单
            function searchPlaylists(query) {
                currentPlaylistPage = 1;
                const filteredPlaylists = getFilteredPlaylists(query);
                renderPlaylists(filteredPlaylists, query, currentPlaylistPage);
                updateURLParams();
            }
            
            // 获取过滤后的歌曲
            function getFilteredSongs(query) {
                if (!query.trim()) {
                    return allSongs;
                }
                
                return allSongs.filter(song => 
                    song.title.toLowerCase().includes(query.toLowerCase()) || 
                    song.artist.toLowerCase().includes(query.toLowerCase())
                );
            }
            
            // 获取过滤后的歌单
            function getFilteredPlaylists(query) {
                if (!query.trim()) {
                    return allPlaylists;
                }
                
                return allPlaylists.filter(playlist => 
                    playlist.name.toLowerCase().includes(query.toLowerCase()) || 
                    playlist.count.includes(query)
                );
            }
            
            // 获取当前显示的歌曲（用于分页）
            function getCurrentSongs() {
                return getFilteredSongs(songSearchInput.value);
            }
            
            // 获取当前显示的歌单（用于分页）
            function getCurrentPlaylists() {
                return getFilteredPlaylists(playlistSearchInput.value);
            }
            
            // 更新URL参数
            function updateURLParams() {
                const url = new URL(window.location);
                const queryParams = new URLSearchParams(url.search);
                
                // 更新查询参数
                const bqlParam = songSearchInput.value;
                const pqlParam = playlistSearchInput.value;
                
                if (bqlParam) {
                    queryParams.set('bql', bqlParam);
                } else {
                    queryParams.delete('bql');
                }
                
                if (pqlParam) {
                    queryParams.set('pql', pqlParam);
                } else {
                    queryParams.delete('pql');
                }
                
                // 构建新的URL
                let newUrl = window.location.pathname;
                if (queryParams.toString()) {
                    newUrl += '?' + queryParams.toString();
                }
                
                // 添加hash参数
                const hashParams = [];
                if (currentSongPage > 1) {
                    hashParams.push(`mp=${currentSongPage}`);
                }
                if (currentPlaylistPage > 1) {
                    hashParams.push(`pp=${currentPlaylistPage}`);
                }
                
                if (hashParams.length > 0) {
                    newUrl += '#' + hashParams.join('&');
                }
                
                // 使用history.replaceState更新URL而不刷新页面
                window.history.replaceState({}, '', newUrl);
            }
            
            // 检查URL参数并应用搜索和分页
            function checkURLParams() {
                const urlParams = new URLSearchParams(window.location.search);
                const bqlParam = urlParams.get('bql');
                const pqlParam = urlParams.get('pql');
                
                // 解析hash参数
                const hashParams = new URLSearchParams(window.location.hash.substring(1));
                const mpParam = parseInt(hashParams.get('mp')) || 1;
                const ppParam = parseInt(hashParams.get('pp')) || 1;
                
                // 设置歌曲搜索和分页
                if (bqlParam && allSongs.length > 0) {
                    songSearchInput.value = bqlParam;
                    currentSongPage = mpParam;
                    renderSongs(getFilteredSongs(bqlParam), bqlParam, currentSongPage);
                } else if (allSongs.length > 0) {
                    currentSongPage = mpParam;
                    renderSongs(allSongs, '', currentSongPage);
                }
                
                // 设置歌单搜索和分页
                if (pqlParam && allPlaylists.length > 0) {
                    playlistSearchInput.value = pqlParam;
                    currentPlaylistPage = ppParam;
                    renderPlaylists(getFilteredPlaylists(pqlParam), pqlParam, currentPlaylistPage);
                } else if (allPlaylists.length > 0) {
                    currentPlaylistPage = ppParam;
                    renderPlaylists(allPlaylists, '', currentPlaylistPage);
                }
            }
            
            // 初始化歌曲部分
            async function initSongs() {
                // 显示加载状态
                songsContainer.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>正在加载歌曲列表...</p>
                    </div>
                `;
                
                // 获取歌曲列表
                allSongs = await fetchSongList();
                
                // 渲染歌曲列表
                renderSongs(allSongs);
                
                // 检查URL参数
                checkURLParams();
            }
            
            // 初始化歌单部分
            async function initPlaylists() {
                // 显示加载状态
                playlistsContainer.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>正在加载歌单列表...</p>
                    </div>
                `;
                
                // 获取歌单列表
                allPlaylists = await fetchPlaylistList();
                
                // 渲染歌单列表
                renderPlaylists(allPlaylists);
                
                // 检查URL参数
                checkURLParams();
            }
            
            // 绑定搜索事件
            songSearchBtn.addEventListener('click', () => {
                searchSongs(songSearchInput.value);
            });
            
            playlistSearchBtn.addEventListener('click', () => {
                searchPlaylists(playlistSearchInput.value);
            });
            
            // 绑定回车键事件
            songSearchInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    searchSongs(songSearchInput.value);
                }
            });
            
            playlistSearchInput.addEventListener('keyup', (event) => {
                if (event.key === 'Enter') {
                    searchPlaylists(playlistSearchInput.value);
                }
            });
            
            // 绑定分页按钮事件
            songPrevBtn.addEventListener('click', () => {
                if (currentSongPage > 1) {
                    currentSongPage--;
                    renderSongs(getCurrentSongs(), songSearchInput.value, currentSongPage);
                    updateURLParams();
                }
            });
            
            songNextBtn.addEventListener('click', () => {
                const filteredSongs = getCurrentSongs();
                const totalPages = Math.ceil(filteredSongs.length / SONGS_PER_PAGE);
                if (currentSongPage < totalPages) {
                    currentSongPage++;
                    renderSongs(filteredSongs, songSearchInput.value, currentSongPage);
                    updateURLParams();
                }
            });
            
            playlistPrevBtn.addEventListener('click', () => {
                if (currentPlaylistPage > 1) {
                    currentPlaylistPage--;
                    renderPlaylists(getCurrentPlaylists(), playlistSearchInput.value, currentPlaylistPage);
                    updateURLParams();
                }
            });
            
            playlistNextBtn.addEventListener('click', () => {
                const filteredPlaylists = getCurrentPlaylists();
                const totalPages = Math.ceil(filteredPlaylists.length / PLAYLISTS_PER_PAGE);
                if (currentPlaylistPage < totalPages) {
                    currentPlaylistPage++;
                    renderPlaylists(filteredPlaylists, playlistSearchInput.value, currentPlaylistPage);
                    updateURLParams();
                }
            });
            
            // 开始初始化
            initSongs();
            initPlaylists();
        });
    </script>
</body>
</html>